<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sort Videos by Views</title>
</head>
<body>
  <nav class="flex justify-between items-center py-4 px-6">
    <div class="logo-div">
      <img src="./icon/Logo.png" alt="logo" class="max-w-24">
    </div>
    <button onclick="sortBy" class="sort-by-view bg-gray-200 rounded-lg py-2 px-4 cursor-pointer">
      Sort by Views
    </button>
    <div class="blog">
      <a href="./blog.html" class="bg-orange-500 px-4 rounded-lg py-2 cursor-pointer" target="_blank">Blog</a>
    </div>
  </nav>

  <div id="videos-container">
    <!-- Videos will be dynamically added here -->
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const sortByViewBtn = document.querySelector('.sort-by-view');
      const videosContainer = document.getElementById('videos-container');

      sortByViewBtn.addEventListener('click', async function () {
        const response = await fetch('https://openapi.programming-hero.com/api/videos/categories');
        const categories = await response.json();

        // Flatten all videos data
        let allVideos = [];
        for (const category of categories) {
          const categoryId = category.category_id;
          const categoryResponse = await fetch(`https://openapi.programming-hero.com/api/videos/category/${categoryId}`);
          const categoryData = await categoryResponse.json();
          allVideos = allVideos.concat(categoryData.data);
        }

        // Sort videos by views
        allVideos.sort((a, b) => parseInt(b.others.views) - parseInt(a.others.views));

        // Render sorted videos
        renderVideos(allVideos);
      });

      function renderVideos(videos) {
        // Clear previous videos
        videosContainer.innerHTML = '';

        // Render videos
        videos.forEach(video => {
          const videoElement = document.createElement('div');
          videoElement.innerHTML = `
            <div>
              <img src="${video.thumbnail}" alt="${video.title}">
              <h2>${video.title}</h2>
              <p>Views: ${video.others.views}</p>
              <p>Posted Date: ${video.others.posted_date}</p>
              <p>Author: ${video.authors[0].profile_name}</p>
              <img src="${video.authors[0].profile_picture}" alt="${video.authors[0].profile_name}">
            </div>
          `;
          videosContainer.appendChild(videoElement);
        });
      }
    });
  </script>
</body>
</html>
